<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AI Personalization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f9fafb;
            min-height: 100vh;
        }

        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-subtitle {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 4px;
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 20px;
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.15s;
            border-left: 3px solid transparent;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .nav-item:hover {
            background: #f9fafb;
            color: #1f2937;
        }

        .nav-item.active {
            background: #eff6ff;
            color: #2563eb;
            border-left-color: #2563eb;
        }

        .nav-item-icon {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid #e5e7eb;
        }

        .demo-link-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 10px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .demo-link-btn:hover {
            background: #059669;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            background: #f9fafb;
        }

        .content-header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 24px 32px;
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .content-header-info h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 4px 0;
        }

        .content-header-info p {
            font-size: 0.9rem;
            color: #6b7280;
            margin: 0;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-danger {
            background: #fef2f2;
            color: #dc2626;
        }

        .btn-danger:hover {
            background: #fee2e2;
        }

        .content-body {
            padding: 32px;
        }

        /* Widget Grid */
        .widget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .widget-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .widget-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }

        .widget-card-icon {
            height: 140px;
            background: #f9fafb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            position: relative;
        }

        .widget-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
        }

        .widget-badge.top { background: #3b82f6; }
        .widget-badge.mid { background: #8b5cf6; }
        .widget-badge.bottom { background: #10b981; }

        .widget-card-content {
            padding: 20px;
        }

        .widget-card-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .widget-card-meta {
            font-size: 0.85rem;
            color: #6b7280;
            margin-bottom: 16px;
        }

        .widget-card-actions {
            display: flex;
            gap: 8px;
        }

        .widget-card-actions .btn {
            flex: 1;
            padding: 8px;
            font-size: 0.85rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: #6b7280;
            margin-bottom: 24px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 32px;
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .funnel-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .funnel-option {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .funnel-option:hover {
            border-color: #d1d5db;
        }

        .funnel-option.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .funnel-option-icon {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }

        .funnel-option-label {
            font-weight: 600;
            font-size: 0.9rem;
            color: #1f2937;
        }

        .funnel-option-sublabel {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 2px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
        }

        .modal-actions .btn {
            flex: 1;
            padding: 12px;
        }

        /* Layout Builder */
        .layout-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .layout-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .layout-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }

        .layout-card-actions {
            display: flex;
            gap: 8px;
        }

        .funnel-stages {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .funnel-stage {
            padding: 20px;
            border-radius: 12px;
        }

        .funnel-stage.top { background: #eff6ff; border: 2px solid #3b82f6; }
        .funnel-stage.mid { background: #f5f3ff; border: 2px solid #8b5cf6; }
        .funnel-stage.bottom { background: #ecfdf5; border: 2px solid #10b981; }

        .funnel-stage-header {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .funnel-stage-range {
            font-size: 0.85rem;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .funnel-stage-count {
            font-size: 0.85rem;
            color: #6b7280;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .template-card {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .template-card:hover {
            border-color: #3b82f6;
            background: #f9fafb;
        }

        .template-card-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .template-card-desc {
            font-size: 0.85rem;
            color: #6b7280;
        }

        .widget-selector {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
        }

        .widget-checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .widget-checkbox-item:hover {
            background: #f9fafb;
        }

        .widget-checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .widget-checkbox-label {
            flex: 1;
            font-size: 0.9rem;
            color: #1f2937;
        }

        .widget-checkbox-type {
            font-size: 0.75rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script type="module">
        import { h, render } from 'https://esm.sh/preact@10.19.3';
        import { useState } from 'https://esm.sh/preact@10.19.3/hooks';
        import htm from 'https://esm.sh/htm@3.1.1';

        const html = htm.bind(h);

        const WIDGET_ICONS = {
            poll: 'üìä',
            nps: '‚≠ê',
            survey: 'üìù',
            newsletter: 'üìÆ',
            blog: '‚úçÔ∏è',
            video: 'üé•',
            doc: 'üìö',
            webinar: 'üìπ',
            demo: 'üéØ'
        };

        const WIDGET_TEMPLATES = [
            { name: 'Quick Poll', type: 'poll', funnelStage: 'top', title: "What's Your Biggest Marketing Challenge?", description: 'Help us understand your priorities' },
            { name: 'NPS Survey', type: 'nps', funnelStage: 'mid', title: 'How Likely Are You to Recommend?', description: 'Share your feedback' },
            { name: 'Demo Booking', type: 'demo', funnelStage: 'bottom', title: 'Book a Personalized Demo', description: 'See the platform in action' },
            { name: 'Newsletter', type: 'newsletter', funnelStage: 'mid', title: 'Subscribe to Insights Weekly', description: 'Get exclusive tips every Tuesday' },
        ];

        // Widget Form Modal
        function WidgetFormModal({ widget, onSave, onClose }) {
            const [formData, setFormData] = useState(widget || {
                id: 'widget_' + Date.now(),
                type: 'poll',
                title: '',
                description: '',
                url: '',
                funnelStage: 'top'
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.title && formData.description && formData.url) {
                    onSave(formData);
                }
            };

            const applyTemplate = (template) => {
                setFormData({
                    ...formData,
                    ...template,
                    url: 'https://example.com/' + template.type
                });
            };

            return html`
                <div class="modal-overlay" onClick=${(e) => e.target.className === 'modal-overlay' && onClose()}>
                    <div class="modal">
                        <div class="modal-header">
                            <h2>${widget ? 'Edit Widget' : 'Create New Widget'}</h2>
                        </div>

                        ${!widget && html`
                            <div style="margin-bottom: 24px;">
                                <label class="form-label">Quick Start Templates</label>
                                <div class="templates-grid">
                                    ${WIDGET_TEMPLATES.map(t => html`
                                        <div class="template-card" onClick=${() => applyTemplate(t)}>
                                            <div class="template-card-title">${t.name}</div>
                                            <div class="template-card-desc">${t.type} ‚Ä¢ ${t.funnelStage}</div>
                                        </div>
                                    `)}
                                </div>
                            </div>
                        `}

                        <form onSubmit=${handleSubmit}>
                            <div class="form-group">
                                <label class="form-label">Widget Type *</label>
                                <select
                                    class="form-select"
                                    value=${formData.type}
                                    onChange=${(e) => setFormData({ ...formData, type: e.target.value })}
                                >
                                    <optgroup label="Interactive">
                                        <option value="poll">üìä Poll</option>
                                        <option value="nps">‚≠ê NPS Survey</option>
                                        <option value="survey">üìù Survey</option>
                                        <option value="newsletter">üìÆ Newsletter</option>
                                    </optgroup>
                                    <optgroup label="Content">
                                        <option value="blog">‚úçÔ∏è Blog Post</option>
                                        <option value="video">üé• Video</option>
                                        <option value="doc">üìö Document</option>
                                        <option value="webinar">üìπ Webinar</option>
                                    </optgroup>
                                    <optgroup label="Conversion">
                                        <option value="demo">üéØ Demo Booking</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Funnel Stage *</label>
                                <div class="funnel-selector">
                                    ${['top', 'mid', 'bottom'].map(stage => html`
                                        <div
                                            class=${`funnel-option ${formData.funnelStage === stage ? 'selected' : ''}`}
                                            onClick=${() => setFormData({ ...formData, funnelStage: stage })}
                                        >
                                            <div class="funnel-option-icon">
                                                ${stage === 'top' ? 'üîµ' : stage === 'mid' ? 'üü£' : 'üü¢'}
                                            </div>
                                            <div class="funnel-option-label">
                                                ${stage === 'top' ? 'Top' : stage === 'mid' ? 'Mid' : 'Bottom'}
                                            </div>
                                            <div class="funnel-option-sublabel">
                                                ${stage === 'top' ? 'Explore' : stage === 'mid' ? 'Engage' : 'Convert'}
                                            </div>
                                        </div>
                                    `)}
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Title *</label>
                                <input
                                    type="text"
                                    class="form-input"
                                    value=${formData.title}
                                    onInput=${(e) => setFormData({ ...formData, title: e.target.value })}
                                    placeholder="e.g., What's Your Biggest Marketing Challenge?"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <textarea
                                    class="form-textarea"
                                    value=${formData.description}
                                    onInput=${(e) => setFormData({ ...formData, description: e.target.value })}
                                    placeholder="Brief description..."
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label class="form-label">URL *</label>
                                <input
                                    type="url"
                                    class="form-input"
                                    value=${formData.url}
                                    onInput=${(e) => setFormData({ ...formData, url: e.target.value })}
                                    placeholder="https://example.com/resource"
                                    required
                                />
                            </div>

                            <div class="modal-actions">
                                <button type="button" class="btn btn-secondary" onClick=${onClose}>Cancel</button>
                                <button type="submit" class="btn btn-primary">
                                    ${widget ? 'Update Widget' : 'Create Widget'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        // Layout Form Modal
        function LayoutFormModal({ layout, widgets, onSave, onClose }) {
            const [formData, setFormData] = useState(layout || {
                id: 'layout_' + Date.now(),
                name: '',
                description: '',
                rules: [
                    { engagementMin: 0, engagementMax: 49, funnelStage: 'top', widgetIds: [] },
                    { engagementMin: 50, engagementMax: 79, funnelStage: 'mid', widgetIds: [] },
                    { engagementMin: 80, engagementMax: 100, funnelStage: 'bottom', widgetIds: [] }
                ]
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.name) {
                    onSave(formData);
                }
            };

            const toggleWidget = (ruleIndex, widgetId) => {
                const newRules = [...formData.rules];
                const widgetIds = newRules[ruleIndex].widgetIds;
                
                if (widgetIds.includes(widgetId)) {
                    newRules[ruleIndex].widgetIds = widgetIds.filter(id => id !== widgetId);
                } else {
                    newRules[ruleIndex].widgetIds = [...widgetIds, widgetId];
                }
                
                setFormData({ ...formData, rules: newRules });
            };

            return html`
                <div class="modal-overlay" onClick=${(e) => e.target.className === 'modal-overlay' && onClose()}>
                    <div class="modal" style="max-width: 800px;">
                        <div class="modal-header">
                            <h2>${layout ? 'Edit Layout' : 'Create New Layout'}</h2>
                        </div>

                        <form onSubmit=${handleSubmit}>
                            <div class="form-group">
                                <label class="form-label">Layout Name *</label>
                                <input
                                    type="text"
                                    class="form-input"
                                    value=${formData.name}
                                    onInput=${(e) => setFormData({ ...formData, name: e.target.value })}
                                    placeholder="e.g., Marketing Event Layout"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <input
                                    type="text"
                                    class="form-input"
                                    value=${formData.description || ''}
                                    onInput=${(e) => setFormData({ ...formData, description: e.target.value })}
                                    placeholder="Brief description..."
                                />
                            </div>

                            ${formData.rules.map((rule, ruleIndex) => html`
                                <div class="form-group" key=${ruleIndex}>
                                    <label class="form-label">
                                        ${rule.funnelStage === 'top' ? 'üîµ Top Funnel (Explore)' : 
                                          rule.funnelStage === 'mid' ? 'üü£ Mid Funnel (Engage)' : 
                                          'üü¢ Bottom Funnel (Convert)'} - ${rule.engagementMin}-${rule.engagementMax}%
                                    </label>
                                    <div class="widget-selector">
                                        ${widgets
                                            .filter(w => w.funnelStage === rule.funnelStage)
                                            .map(widget => html`
                                                <label class="widget-checkbox-item" key=${widget.id}>
                                                    <input
                                                        type="checkbox"
                                                        checked=${rule.widgetIds.includes(widget.id)}
                                                        onChange=${() => toggleWidget(ruleIndex, widget.id)}
                                                    />
                                                    <div style="flex: 1;">
                                                        <div class="widget-checkbox-label">
                                                            ${WIDGET_ICONS[widget.type]} ${widget.title}
                                                        </div>
                                                        <div class="widget-checkbox-type">${widget.type}</div>
                                                    </div>
                                                </label>
                                            `)}
                                        ${widgets.filter(w => w.funnelStage === rule.funnelStage).length === 0 && html`
                                            <div style="text-align: center; padding: 20px; color: #6b7280;">
                                                No ${rule.funnelStage} funnel widgets available. Create widgets first.
                                            </div>
                                        `}
                                    </div>
                                </div>
                            `)}

                            <div class="modal-actions">
                                <button type="button" class="btn btn-secondary" onClick=${onClose}>Cancel</button>
                                <button type="submit" class="btn btn-primary">
                                    ${layout ? 'Update Layout' : 'Create Layout'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        // Main App Component
        function App() {
            const [currentPage, setCurrentPage] = useState('widgets');
            const [widgets, setWidgets] = useState([
                { id: 'widget_1', type: 'poll', title: "What's Your Biggest Marketing Challenge?", description: 'Help us understand your priorities', url: 'https://example.com/poll', funnelStage: 'top' },
                { id: 'widget_2', type: 'blog', title: '7 Event Marketing Trends Shaping 2024', description: 'Latest insights', url: 'https://example.com/blog', funnelStage: 'top' },
                { id: 'widget_3', type: 'nps', title: 'How Likely Are You to Recommend?', description: 'Share your feedback', url: 'https://example.com/nps', funnelStage: 'mid' },
                { id: 'widget_4', type: 'demo', title: 'Book a Personalized Demo', description: 'See the platform in action', url: 'https://example.com/demo', funnelStage: 'bottom' },
            ]);
            const [layouts, setLayouts] = useState([
                {
                    id: 'layout_1',
                    name: 'Default Marketing Layout',
                    description: 'Standard funnel progression',
                    rules: [
                        { engagementMin: 0, engagementMax: 49, funnelStage: 'top', widgetIds: ['widget_1', 'widget_2'] },
                        { engagementMin: 50, engagementMax: 79, funnelStage: 'mid', widgetIds: ['widget_3'] },
                        { engagementMin: 80, engagementMax: 100, funnelStage: 'bottom', widgetIds: ['widget_4'] }
                    ]
                }
            ]);
            const [showWidgetModal, setShowWidgetModal] = useState(false);
            const [showLayoutModal, setShowLayoutModal] = useState(false);
            const [editingWidget, setEditingWidget] = useState(null);
            const [editingLayout, setEditingLayout] = useState(null);

            const handleSaveWidget = (widget) => {
                if (editingWidget) {
                    setWidgets(widgets.map(w => w.id === widget.id ? widget : w));
                } else {
                    setWidgets([...widgets, widget]);
                }
                setShowWidgetModal(false);
                setEditingWidget(null);
            };

            const handleDeleteWidget = (id) => {
                if (confirm('Delete this widget?')) {
                    setWidgets(widgets.filter(w => w.id !== id));
                }
            };

            const handleSaveLayout = (layout) => {
                if (editingLayout) {
                    setLayouts(layouts.map(l => l.id === layout.id ? layout : l));
                } else {
                    setLayouts([...layouts, layout]);
                }
                setShowLayoutModal(false);
                setEditingLayout(null);
            };

            const handleDeleteLayout = (id) => {
                if (confirm('Delete this layout?')) {
                    setLayouts(layouts.filter(l => l.id !== id));
                }
            };

            return html`
                <div class="app-container">
                    <!-- Sidebar -->
                    <div class="sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-logo">
                                üéØ AI Admin
                            </div>
                            <div class="sidebar-subtitle">Personalization Dashboard</div>
                        </div>

                        <div class="sidebar-nav">
                            <div class="nav-section">
                                <div class="nav-section-title">Manage</div>
                                <div
                                    class=${`nav-item ${currentPage === 'widgets' ? 'active' : ''}`}
                                    onClick=${() => setCurrentPage('widgets')}
                                >
                                    <span class="nav-item-icon">üß©</span>
                                    <span>Widgets</span>
                                </div>
                                <div
                                    class=${`nav-item ${currentPage === 'layouts' ? 'active' : ''}`}
                                    onClick=${() => setCurrentPage('layouts')}
                                >
                                    <span class="nav-item-icon">üìê</span>
                                    <span>Layouts</span>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-footer">
                            <a href="/test-ai-personalization.html" class="demo-link-btn">
                                üëÅÔ∏è View User Demo
                            </a>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="main-content">
                        ${currentPage === 'widgets' && html`
                            <div class="content-header">
                                <div class="content-header-info">
                                    <h1>Widgets</h1>
                                    <p>Create and manage content widgets for your events</p>
                                </div>
                                <button class="btn btn-primary" onClick=${() => { setEditingWidget(null); setShowWidgetModal(true); }}>
                                    + Create Widget
                                </button>
                            </div>

                            <div class="content-body">
                                ${widgets.length === 0 ? html`
                                    <div class="empty-state">
                                        <div class="empty-state-icon">üß©</div>
                                        <h3>No widgets yet</h3>
                                        <p>Create your first widget to get started</p>
                                        <button class="btn btn-primary" onClick=${() => setShowWidgetModal(true)}>
                                            + Create Widget
                                        </button>
                                    </div>
                                ` : html`
                                    <div class="widget-grid">
                                        ${widgets.map(widget => html`
                                            <div class="widget-card" key=${widget.id}>
                                                <div class="widget-card-icon">
                                                    ${WIDGET_ICONS[widget.type]}
                                                    <div class=${`widget-badge ${widget.funnelStage}`}>
                                                        ${widget.funnelStage === 'top' ? 'üîµ' : widget.funnelStage === 'mid' ? 'üü£' : 'üü¢'}
                                                    </div>
                                                </div>
                                                <div class="widget-card-content">
                                                    <div class="widget-card-title">${widget.title}</div>
                                                    <div class="widget-card-meta">${widget.type} ‚Ä¢ ${widget.funnelStage} funnel</div>
                                                    <div class="widget-card-actions">
                                                        <button class="btn btn-secondary" onClick=${() => { setEditingWidget(widget); setShowWidgetModal(true); }}>
                                                            Edit
                                                        </button>
                                                        <button class="btn btn-danger" onClick=${() => handleDeleteWidget(widget.id)}>
                                                            Delete
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        `)}
                                    </div>
                                `}
                            </div>
                        `}

                        ${currentPage === 'layouts' && html`
                            <div class="content-header">
                                <div class="content-header-info">
                                    <h1>Layouts</h1>
                                    <p>Configure funnel-based widget display rules</p>
                                </div>
                                <button class="btn btn-primary" onClick=${() => { setEditingLayout(null); setShowLayoutModal(true); }}>
                                    + Create Layout
                                </button>
                            </div>

                            <div class="content-body">
                                ${layouts.length === 0 ? html`
                                    <div class="empty-state">
                                        <div class="empty-state-icon">üìê</div>
                                        <h3>No layouts yet</h3>
                                        <p>Create your first layout to configure widget display rules</p>
                                        <button class="btn btn-primary" onClick=${() => setShowLayoutModal(true)}>
                                            + Create Layout
                                        </button>
                                    </div>
                                ` : html`
                                    ${layouts.map(layout => html`
                                        <div class="layout-card" key=${layout.id}>
                                            <div class="layout-card-header">
                                                <div>
                                                    <div class="layout-card-title">${layout.name}</div>
                                                    <div style="font-size: 0.9rem; color: #6b7280; margin-top: 4px;">${layout.description}</div>
                                                </div>
                                                <div class="layout-card-actions">
                                                    <button class="btn btn-secondary" onClick=${() => { setEditingLayout(layout); setShowLayoutModal(true); }}>
                                                        Edit
                                                    </button>
                                                    <button class="btn btn-danger" onClick=${() => handleDeleteLayout(layout.id)}>
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="funnel-stages">
                                                ${layout.rules.map(rule => html`
                                                    <div class=${`funnel-stage ${rule.funnelStage}`} key=${rule.funnelStage}>
                                                        <div class="funnel-stage-header">
                                                            ${rule.funnelStage === 'top' ? 'üîµ Top Funnel' : 
                                                              rule.funnelStage === 'mid' ? 'üü£ Mid Funnel' : 
                                                              'üü¢ Bottom Funnel'}
                                                        </div>
                                                        <div class="funnel-stage-range">${rule.engagementMin}-${rule.engagementMax}%</div>
                                                        <div class="funnel-stage-count">${rule.widgetIds.length} widget${rule.widgetIds.length !== 1 ? 's' : ''}</div>
                                                    </div>
                                                `)}
                                            </div>
                                        </div>
                                    `)}
                                `}
                            </div>
                        `}
                    </div>

                    <!-- Modals -->
                    ${showWidgetModal && html`
                        <${WidgetFormModal}
                            widget=${editingWidget}
                            onSave=${handleSaveWidget}
                            onClose=${() => { setShowWidgetModal(false); setEditingWidget(null); }}
                        />
                    `}

                    ${showLayoutModal && html`
                        <${LayoutFormModal}
                            layout=${editingLayout}
                            widgets=${widgets}
                            onSave=${handleSaveLayout}
                            onClose=${() => { setShowLayoutModal(false); setEditingLayout(null); }}
                        />
                    `}
                </div>
            `;
        }

        render(html`<${App} />`, document.getElementById('app'));
    </script>
</body>
</html>



